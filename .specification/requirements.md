# Требования к системе arXiv RAG

## Функциональные требования

### 1. Загрузка статей с arXiv.org
**FR-001: Поиск статей**
- Система должна поддерживать поиск статей на arXiv.org по текстовому запросу
- Поддерживать ограничение количества результатов (по умолчанию 10)
- Сортировать результаты по релевантности

**FR-002: Загрузка PDF файлов**
- Автоматически скачивать PDF файлы найденных статей
- Сохранять файлы в локальную директорию `./papers/`
- Избегать повторной загрузки уже существующих файлов
- Обрабатывать ошибки загрузки

**FR-003: Метаданные статей**
- Извлекать и сохранять метаданные статей:
  - ID статьи
  - Название
  - Авторы
  - Аннотация
  - Дата публикации
  - Категории
  - URL PDF файла

### 2. Обработка документов
**FR-004: Парсинг PDF**
- Извлекать текст из PDF файлов статей
- Разбивать текст на чанки размером 512 токенов с перекрытием 50 токенов
- Обрабатывать ошибки парсинга

**FR-005: Векторизация**
- Создавать векторные представления текстовых чанков
- Использовать OpenAI Embeddings для генерации эмбеддингов
- Сохранять векторы в ChromaDB

### 3. Поиск и анализ
**FR-006: Семантический поиск**
- Выполнять поиск по векторной базе данных
- Возвращать топ-3 наиболее релевантных чанка
- Поддерживать контекстный поиск с учетом семантики

**FR-007: Генерация ответов**
- Использовать OpenAI GPT-3.5-turbo для генерации ответов
- Формировать ответы на основе найденных релевантных чанков
- Предоставлять источники информации

### 4. CLI интерфейс
**FR-008: Команда fetch**
```bash
python cli.py fetch "query" [--max-results N] [--papers-dir PATH]
```
- Поиск и загрузка статей по запросу
- Автоматическое добавление загруженных статей в поисковую базу

**FR-009: Команда search**
```bash
python cli.py search "question" [--papers-dir PATH]
```
- Поиск ответов на вопросы в загруженных статьях
- Отображение ответа и источников

**FR-010: Команда list**
```bash
python cli.py list [--papers-dir PATH]
```
- Отображение списка загруженных статей

**FR-011: Команда clear**
```bash
python cli.py clear
```
- Очистка векторной базы данных
- Подтверждение действия пользователем

**FR-012: Форматирование ответов в Markdown**
- Генерировать ответы в формате Markdown
- Включать заголовки, списки, цитаты
- Форматировать источники как ссылки
- Поддерживать структурированный вывод

**FR-013: Сохранение ответов в файл**
```bash
python cli.py search "question" --save-to-file [--output-dir PATH]
```
- Сохранять ответы в MD файлы
- Автоматически генерировать имена файлов на основе запроса
- Поддерживать указание директории для сохранения
- Создавать директорию `./output/` по умолчанию

## Нефункциональные требования

### 1. Производительность
**NFR-001: Скорость загрузки**
- Загрузка 10 статей должна занимать не более 2 минут
- Парсинг PDF файла должен занимать не более 30 секунд

**NFR-002: Скорость поиска**
- Поиск по базе данных должен выполняться за время не более 5 секунд
- Генерация ответа должна занимать не более 10 секунд

### 2. Надежность
**NFR-003: Обработка ошибок**
- Система должна корректно обрабатывать ошибки сети при загрузке
- Продолжать работу при ошибках парсинга отдельных файлов
- Предоставлять понятные сообщения об ошибках

**NFR-004: Устойчивость**
- Система должна восстанавливаться после сбоев
- Сохранять состояние векторной базы данных

### 3. Простота использования
**NFR-005: CLI интерфейс**
- Команды должны быть интуитивно понятными
- Предоставлять справку по использованию
- Минимальное количество обязательных параметров

**NFR-006: Настройка**
- Простая настройка через файл .env
- Минимальные требования к конфигурации

**NFR-009: Форматирование вывода**
- Поддержка Markdown разметки в ответах
- Структурированный и читаемый формат
- Возможность сохранения в файлы

### 4. Масштабируемость
**NFR-007: Объем данных**
- Поддержка до 1000 статей в базе данных
- Эффективная работа с большими PDF файлами

**NFR-008: Расширяемость**
- Возможность добавления новых источников данных
- Модульная архитектура для легкого расширения

## Технические требования

### 0. Управление зависимостями
**TR-000: uv - основной инструмент управления зависимостями**
- **uv** - современный и быстрый менеджер пакетов Python
- **pyproject.toml** - основная конфигурация проекта (вместо requirements.txt)
- **Команды установки**: `uv sync`, `uv add package-name`
- **Активация окружения**: `uv shell`
- **Создание проекта**: `uv init`
- **Установка зависимостей**: `uv sync --dev` (включая dev зависимости)

### 1. Зависимости
**TR-001: Python библиотеки (управляемые через uv)**
- arxiv>=2.1.0 - интеграция с arXiv API
- click>=8.1.7 - CLI интерфейс
- langchain>=0.1.0 - RAG фреймворк
- chromadb>=0.4.18 - векторная база данных
- openai>=1.0.0 - LLM API
- pypdf2>=3.0.1 - парсинг PDF
- requests>=2.31.0 - HTTP запросы
- python-dotenv>=1.0.0 - управление переменными окружения
- markdown>=3.5.1 - обработка Markdown
- pyyaml>=6.0.1 - конфигурация YAML

**TR-001-dev: Development зависимости**
- pytest>=7.4.3 - тестирование
- pytest-cov>=4.1.0 - покрытие тестами
- black>=23.11.0 - форматирование кода
- flake8>=6.1.0 - линтинг
- mypy>=1.0.0 - проверка типов

### 2. Системные требования
**TR-002: Операционная система**
- Linux, macOS, Windows
- Python 3.8+
- uv установлен в системе

**TR-003: Ресурсы**
- Минимум 2GB RAM
- 1GB свободного места на диске
- Интернет соединение для доступа к arXiv и OpenAI API

### 3. Внешние сервисы
**TR-004: API ключи**
- OpenAI API ключ для эмбеддингов и генерации ответов
- Доступ к arXiv.org API (бесплатный)

## Ограничения системы

### 1. Функциональные ограничения
**LIM-001: Источники данных**
- Только статьи с arXiv.org
- Только PDF формат файлов
- Нет поддержки других научных баз данных

**LIM-002: Языки**
- Только английский язык для поиска и ответов
- Ограниченная поддержка других языков в статьях

### 2. Технические ограничения
**LIM-003: Производительность**
- Один поток обработки документов
- Нет кэширования результатов
- Ограничения OpenAI API по скорости запросов

**LIM-004: Безопасность**
- Нет аутентификации пользователей
- API ключи хранятся в открытом виде в .env файле
- Нет аудита действий пользователей

## Критерии приемки

### 1. Основной сценарий использования
**AC-001: Загрузка и поиск статей**
```
GIVEN пользователь имеет настроенный OpenAI API ключ
WHEN пользователь выполняет команду: python cli.py fetch "LLM RAG"
THEN система загружает до 10 статей с arXiv.org
AND сохраняет PDF файлы в директорию ./papers/
AND индексирует статьи в векторной базе данных
AND выводит сообщение об успешной загрузке
```

**AC-002: Поиск информации**
```
GIVEN в системе есть загруженные статьи
WHEN пользователь выполняет команду: python cli.py search "What is RAG?"
THEN система находит релевантные фрагменты текста
AND генерирует ответ на основе найденной информации
AND выводит ответ с указанием источников
```

### 2. Дополнительные сценарии
**AC-003: Управление статьями**
```
GIVEN в системе есть загруженные статьи
WHEN пользователь выполняет команду: python cli.py list
THEN система выводит список всех загруженных PDF файлов
```

**AC-004: Очистка данных**
```
GIVEN пользователь хочет очистить базу данных
WHEN пользователь выполняет команду: python cli.py clear
THEN система запрашивает подтверждение
AND при подтверждении очищает векторную базу данных
```

**AC-005: Форматирование ответов в Markdown**
```
GIVEN в системе есть загруженные статьи
WHEN пользователь выполняет команду: python cli.py search "What is RAG?"
THEN система генерирует ответ в формате Markdown
AND включает заголовки, списки и цитаты
AND форматирует источники как ссылки
AND выводит структурированный ответ
```

**AC-006: Сохранение ответов в файл**
```
GIVEN пользователь хочет сохранить ответ в файл
WHEN пользователь выполняет команду: python cli.py search "What is RAG?" --save-to-file
THEN система генерирует ответ в формате Markdown
AND сохраняет его в файл с автоматически сгенерированным именем
AND создает директорию ./output/ если она не существует
AND выводит путь к сохраненному файлу
```

## Приоритеты разработки

### Высокий приоритет (MVP)
1. **arXiv Fetcher** - загрузка статей с arXiv.org
2. **Document Parser** - извлечение текста из PDF
3. **RAG Engine** - поиск и генерация ответов
4. **CLI Interface** - базовые команды (fetch, search, list, clear)

### Средний приоритет
1. **Форматирование ответов в Markdown**
2. **Сохранение ответов в файлы**
3. **Улучшенная обработка ошибок**
4. **Прогресс-бары для длительных операций**
5. **Цветной вывод в CLI**
6. **Кэширование результатов**

### Низкий приоритет
1. **Поддержка других источников данных**
2. **Веб-интерфейс**
3. **Аналитика использования**
4. **Интеграция с другими LLM**

## Метрики успеха

### 1. Функциональные метрики
- **Время загрузки**: < 2 минут для 10 статей
- **Точность поиска**: > 80% релевантных результатов в топ-3
- **Время ответа**: < 10 секунд на запрос

### 2. Пользовательские метрики
- **Простота настройки**: < 5 минут от установки до первого использования
- **Удобство использования**: интуитивно понятные команды
- **Надежность**: < 5% ошибок при нормальной работе

### 3. Технические метрики
- **Стабильность**: работа без сбоев в течение 24 часов
- **Потребление ресурсов**: < 2GB RAM при работе с 100 статьями
- **Совместимость**: работа на всех поддерживаемых ОС

## Команды для работы с uv

### Установка и настройка
```bash
# Инициализация проекта
uv init

# Установка зависимостей
uv sync

# Установка с dev зависимостями
uv sync --dev

# Активация виртуального окружения
uv shell
```

### Управление зависимостями
```bash
# Добавление новой зависимости
uv add package-name

# Добавление dev зависимости
uv add --dev package-name

# Удаление зависимости
uv remove package-name

# Обновление зависимостей
uv sync --upgrade
```

### Запуск приложения
```bash
# Активация окружения и запуск
uv run python cli.py --help

# Или после uv shell
python cli.py --help
```
